<template><div><h1 id="ğŸ“š-æ¼«ç”»ä¸“åŒº" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-æ¼«ç”»ä¸“åŒº"><span>ğŸ“š æ¼«ç”»ä¸“åŒº</span></a></h1>
<div class="manga-zone">
  <!-- åŠ è½½çŠ¶æ€ -->
  <div id="loading-state" class="loading-state">
    <div class="loading-spinner"></div>
    <p>æ­£åœ¨åŠ è½½æ¼«ç”»æ•°æ®...</p>
  </div>
  <!-- é”™è¯¯çŠ¶æ€ -->
  <div id="error-state" class="error-state" style="display: none;">
    <h3>ğŸ˜” åŠ è½½å¤±è´¥</h3>
    <p>æ— æ³•è¿æ¥åˆ°æ•°æ®åº“ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•</p>
    <button class="retry-button" onclick="loadMangaData()">é‡æ–°åŠ è½½</button>
  </div>
  <!-- ç©ºçŠ¶æ€ -->
  <div id="empty-state" class="empty-state" style="display: none;">
    <h3>ğŸ“š æš‚æ— æ¼«ç”»æ•°æ®</h3>
    <p>æ•°æ®åº“ä¸­è¿˜æ²¡æœ‰æ¼«ç”»ä¿¡æ¯ï¼Œè¯·ç¨åå†æ¥æŸ¥çœ‹</p>
  </div>
  <!-- ç­›é€‰å™¨ -->
  <div id="filters" class="filters" style="display: none;">
    <div class="filter-group">
      <label for="genre-filter">ç±»å‹ç­›é€‰</label>
      <select id="genre-filter">
        <option value="">å…¨éƒ¨ç±»å‹</option>
      </select>
    </div>
<pre><code>&lt;div class=&quot;filter-group&quot;&gt;
  &lt;label for=&quot;status-filter&quot;&gt;çŠ¶æ€ç­›é€‰&lt;/label&gt;
  &lt;select id=&quot;status-filter&quot;&gt;
    &lt;option value=&quot;&quot;&gt;å…¨éƒ¨çŠ¶æ€&lt;/option&gt;
    &lt;option value=&quot;reading&quot;&gt;æ­£åœ¨é˜…è¯»&lt;/option&gt;
    &lt;option value=&quot;completed&quot;&gt;å·²å®Œæˆ&lt;/option&gt;
    &lt;option value=&quot;planned&quot;&gt;è®¡åˆ’é˜…è¯»&lt;/option&gt;
    &lt;option value=&quot;paused&quot;&gt;æš‚åœ&lt;/option&gt;
    &lt;option value=&quot;dropped&quot;&gt;å·²å¼ƒå‘&lt;/option&gt;
  &lt;/select&gt;
&lt;/div&gt;

&lt;div class=&quot;filter-group&quot;&gt;
  &lt;label for=&quot;rating-filter&quot;&gt;è¯„åˆ†ç­›é€‰&lt;/label&gt;
  &lt;select id=&quot;rating-filter&quot;&gt;
    &lt;option value=&quot;&quot;&gt;å…¨éƒ¨è¯„åˆ†&lt;/option&gt;
    &lt;option value=&quot;9&quot;&gt;9åˆ†ä»¥ä¸Š&lt;/option&gt;
    &lt;option value=&quot;8&quot;&gt;8åˆ†ä»¥ä¸Š&lt;/option&gt;
    &lt;option value=&quot;7&quot;&gt;7åˆ†ä»¥ä¸Š&lt;/option&gt;
    &lt;option value=&quot;6&quot;&gt;6åˆ†ä»¥ä¸Š&lt;/option&gt;
  &lt;/select&gt;
&lt;/div&gt;

&lt;div class=&quot;filter-group&quot;&gt;
  &lt;label for=&quot;search-input&quot;&gt;æœç´¢æ¼«ç”»&lt;/label&gt;
  &lt;input type=&quot;text&quot; id=&quot;search-input&quot; placeholder=&quot;è¾“å…¥æ¼«ç”»åç§°...&quot;&gt;
&lt;/div&gt;
</code></pre>
  </div>
  <!-- æ¼«ç”»ç½‘æ ¼ -->
  <div id="manga-grid" class="manga-grid" style="display: none;">
    <!-- æ¼«ç”»å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
  </div>
  <!-- AIåŠ©æ‰‹æµ®åŠ¨æŒ‰é’® -->
  <div class="ai-assistant-fab" id="aiAssistantFab" title="AIæ¼«ç”»åŠ©æ‰‹">
    <span class="ai-fab-icon">ğŸ¤–</span>
    <span class="ai-fab-text">AIåŠ©æ‰‹</span>
  </div>
</div>
<div class="manga-grid">
  <!-- æ¼«ç”»å¡ç‰‡ 1 -->
  <div class="manga-card" data-genre="comedy,action,slice-of-life" data-status="reading" data-rating="9.3">
    <div class="manga-cover">
      <img src="https://via.placeholder.com/200x280/FF6B6B/FFFFFF?text=é—´è°è¿‡å®¶å®¶" alt="é—´è°è¿‡å®¶å®¶">
      <div class="manga-overlay">
        <div class="manga-rating">9.3</div>
        <div class="manga-status reading">è¿è½½ä¸­</div>
      </div>
    </div>
    <div class="manga-info">
      <h3 class="manga-title">é—´è°è¿‡å®¶å®¶</h3>
      <p class="manga-genres">å–œå‰§ Â· åŠ¨ä½œ Â· å®¶åº­</p>
      <p class="manga-author">è¿œè—¤è¾¾å“‰</p>
      <p class="manga-progress">ç¬¬95è¯ / è¿è½½ä¸­</p>
      <div class="manga-description">
        é—´è°é»„æ˜ä¸ºäº†ä»»åŠ¡ç»„å»ºä¼ªè£…å®¶åº­ï¼Œä¸æ€æ‰‹çº¦å„¿å’Œè¶…èƒ½åŠ›å°‘å¥³é˜¿å°¼äºšçš„æ¸©é¦¨æç¬‘æ—¥å¸¸...
      </div>
      <a href="/Anime/manga/spy-family.html" class="manga-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
    </div>
  </div>
  <!-- æ¼«ç”»å¡ç‰‡ 2 -->
  <div class="manga-card" data-genre="action,fantasy" data-status="reading" data-rating="9.1">
    <div class="manga-cover">
      <img src="https://via.placeholder.com/200x280/4ECDC4/FFFFFF?text=å’’æœ¯å›æˆ˜" alt="å’’æœ¯å›æˆ˜">
      <div class="manga-overlay">
        <div class="manga-rating">9.1</div>
        <div class="manga-status reading">è¿è½½ä¸­</div>
      </div>
    </div>
    <div class="manga-info">
      <h3 class="manga-title">å’’æœ¯å›æˆ˜</h3>
      <p class="manga-genres">åŠ¨ä½œ Â· å¥‡å¹» Â· çƒ­è¡€</p>
      <p class="manga-author">èŠ¥è§ä¸‹ä¸‹</p>
      <p class="manga-progress">ç¬¬248è¯ / è¿è½½ä¸­</p>
      <div class="manga-description">
        è™æ–æ‚ ä»æ„å¤–åä¸‹å’’ç‰©æ‰‹æŒ‡ï¼Œå·å…¥å’’æœ¯å¸ˆä¸å’’çµçš„æˆ˜æ–—ä¸–ç•Œ...
      </div>
      <a href="/Anime/manga/jujutsu-kaisen.html" class="manga-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
    </div>
  </div>
  <!-- æ¼«ç”»å¡ç‰‡ 3 -->
  <div class="manga-card" data-genre="action,drama" data-status="completed" data-rating="9.5">
    <div class="manga-cover">
      <img src="https://via.placeholder.com/200x280/45B7D1/FFFFFF?text=é¬¼ç­ä¹‹åˆƒ" alt="é¬¼ç­ä¹‹åˆƒ">
      <div class="manga-overlay">
        <div class="manga-rating">9.5</div>
        <div class="manga-status completed">å·²å®Œç»“</div>
      </div>
    </div>
    <div class="manga-info">
      <h3 class="manga-title">é¬¼ç­ä¹‹åˆƒ</h3>
      <p class="manga-genres">åŠ¨ä½œ Â· å‰§æƒ… Â· çƒ­è¡€</p>
      <p class="manga-author">å¾å³ å‘¼ä¸–æ™´</p>
      <p class="manga-progress">205è¯ / å·²å®Œç»“</p>
      <div class="manga-description">
        ç‚­æ²»éƒä¸ºäº†æ‹¯æ•‘å˜æˆé¬¼çš„å¦¹å¦¹ç¥¢è±†å­ï¼Œè¸ä¸Šæˆä¸ºé¬¼æ€é˜Ÿå‰‘å£«çš„é“è·¯...
      </div>
      <a href="/Anime/manga/demon-slayer.html" class="manga-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
    </div>
  </div>
  <!-- æ¼«ç”»å¡ç‰‡ 4 -->
  <div class="manga-card" data-genre="action,drama" data-status="completed" data-rating="9.8">
    <div class="manga-cover">
      <img src="https://via.placeholder.com/200x280/96CEB4/FFFFFF?text=è¿›å‡»çš„å·¨äºº" alt="è¿›å‡»çš„å·¨äºº">
      <div class="manga-overlay">
        <div class="manga-rating">9.8</div>
        <div class="manga-status completed">å·²å®Œç»“</div>
      </div>
    </div>
    <div class="manga-info">
      <h3 class="manga-title">è¿›å‡»çš„å·¨äºº</h3>
      <p class="manga-genres">åŠ¨ä½œ Â· å‰§æƒ… Â· æ‚¬ç–‘</p>
      <p class="manga-author">è°å±±åˆ›</p>
      <p class="manga-progress">139è¯ / å·²å®Œç»“</p>
      <div class="manga-description">
        äººç±»ä¸å·¨äººçš„ç”Ÿå­˜æˆ˜äº‰ï¼Œéšè—åœ¨é«˜å¢™åçš„çœŸç›¸é€æ¸æ­å¼€...
      </div>
      <a href="/Anime/manga/attack-on-titan.html" class="manga-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
    </div>
  </div>
  <!-- æ¼«ç”»å¡ç‰‡ 5 -->
  <div class="manga-card" data-genre="romance,comedy,slice-of-life" data-status="completed" data-rating="8.7">
    <div class="manga-cover">
      <img src="https://via.placeholder.com/200x280/FFEAA7/333333?text=è¾‰å¤œå¤§å°å§" alt="è¾‰å¤œå¤§å°å§">
      <div class="manga-overlay">
        <div class="manga-rating">8.7</div>
        <div class="manga-status completed">å·²å®Œç»“</div>
      </div>
    </div>
    <div class="manga-info">
      <h3 class="manga-title">è¾‰å¤œå¤§å°å§æƒ³è®©æˆ‘å‘Šç™½</h3>
      <p class="manga-genres">æ‹çˆ± Â· å–œå‰§ Â· æ ¡å›­</p>
      <p class="manga-author">èµ¤å‚æ˜</p>
      <p class="manga-progress">281è¯ / å·²å®Œç»“</p>
      <div class="manga-description">
        å­¦ç”Ÿä¼šé•¿ç™½é“¶ä¸å‰¯ä¼šé•¿è¾‰å¤œçš„æ‹çˆ±å¤´è„‘æˆ˜ï¼Œè°å…ˆå‘Šç™½è°å°±è¾“äº†...
      </div>
      <a href="/Anime/manga/kaguya-sama.html" class="manga-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
    </div>
  </div>
  <!-- æ¼«ç”»å¡ç‰‡ 6 -->
  <div class="manga-card" data-genre="adventure,comedy" data-status="planned" data-rating="0">
    <div class="manga-cover">
      <img src="https://via.placeholder.com/200x280/DDA0DD/FFFFFF?text=æµ·è´¼ç‹" alt="æµ·è´¼ç‹">
      <div class="manga-overlay">
        <div class="manga-rating">-</div>
        <div class="manga-status planned">è®¡åˆ’é˜…è¯»</div>
      </div>
    </div>
    <div class="manga-info">
      <h3 class="manga-title">æµ·è´¼ç‹</h3>
      <p class="manga-genres">å†’é™© Â· å–œå‰§ Â· çƒ­è¡€</p>
      <p class="manga-author">å°¾ç”°è£ä¸€éƒ</p>
      <p class="manga-progress">1100+è¯ / è¿è½½ä¸­</p>
      <div class="manga-description">
        è·¯é£å’Œä¼™ä¼´ä»¬å¯»æ‰¾ä¼ è¯´ä¸­çš„å¤§ç§˜å®ONE PIECEçš„å†’é™©æ•…äº‹...
      </div>
      <a href="/Anime/manga/one-piece.html" class="manga-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
    </div>
  </div>
  <!-- æ¼«ç”»å¡ç‰‡ 7 -->
  <div class="manga-card" data-genre="mystery,drama" data-status="completed" data-rating="8.9">
    <div class="manga-cover">
      <img src="https://via.placeholder.com/200x280/FF9FF3/FFFFFF?text=çº¦å®šçš„æ¢¦å¹»å²›" alt="çº¦å®šçš„æ¢¦å¹»å²›">
      <div class="manga-overlay">
        <div class="manga-rating">8.9</div>
        <div class="manga-status completed">å·²å®Œç»“</div>
      </div>
    </div>
    <div class="manga-info">
      <h3 class="manga-title">çº¦å®šçš„æ¢¦å¹»å²›</h3>
      <p class="manga-genres">æ¨ç† Â· å‰§æƒ… Â· æ‚¬ç–‘</p>
      <p class="manga-author">ç™½äº•ã‚«ã‚¤ã‚¦</p>
      <p class="manga-progress">181è¯ / å·²å®Œç»“</p>
      <div class="manga-description">
        å­¤å„¿é™¢çš„å­©å­ä»¬å‘ç°è‡ªå·±è¢«å½“ä½œé£Ÿç‰©é¥²å…»ï¼Œç­–åˆ’é€ƒè„±è®¡åˆ’...
      </div>
      <a href="/Anime/manga/promised-neverland.html" class="manga-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
    </div>
  </div>
  <!-- æ¼«ç”»å¡ç‰‡ 8 -->
  <div class="manga-card" data-genre="slice-of-life,comedy" data-status="reading" data-rating="8.4">
    <div class="manga-cover">
      <img src="https://via.placeholder.com/200x280/74B9FF/FFFFFF?text=å¤è§åŒå­¦" alt="å¤è§åŒå­¦">
      <div class="manga-overlay">
        <div class="manga-rating">8.4</div>
        <div class="manga-status reading">è¿è½½ä¸­</div>
      </div>
    </div>
    <div class="manga-info">
      <h3 class="manga-title">å¤è§åŒå­¦æœ‰äº¤æµéšœç¢ç—‡</h3>
      <p class="manga-genres">æ—¥å¸¸ Â· å–œå‰§ Â· æ ¡å›­</p>
      <p class="manga-author">ã‚ªãƒ€ãƒˆãƒ¢ãƒ’ãƒˆ</p>
      <p class="manga-progress">ç¬¬420è¯ / è¿è½½ä¸­</p>
      <div class="manga-description">
        æ‚£æœ‰äº¤æµéšœç¢çš„å¤è§åŒå­¦æƒ³è¦äº¤åˆ°100ä¸ªæœ‹å‹çš„æ¸©é¦¨æ ¡å›­æ•…äº‹...
      </div>
      <a href="/Anime/manga/komi-san.html" class="manga-link">æŸ¥çœ‹è¯¦æƒ… â†’</a>
    </div>
  </div>
</div>
</div></template>

<script>
// é™æ€æ•°æ®ï¼Œç”¨äºæ„å»ºæ—¶çš„å…¼å®¹æ€§
const staticMangaData = [
  {
    id: 'spy-family',
    title: 'é—´è°è¿‡å®¶å®¶',
    subtitle: 'SPYÃ—FAMILY',
    author: 'è¿œè—¤è¾¾å“‰',
    status: 'ongoing',
    rating: 9.5,
    genres: ['å–œå‰§', 'åŠ¨ä½œ', 'å®¶åº­'],
    year: 2019,
    coverImage: 'https://via.placeholder.com/200x280/FF6B6B/FFFFFF?text=é—´è°è¿‡å®¶å®¶',
    summary: 'ä¸ºäº†å®Œæˆä»»åŠ¡ï¼Œé—´è°é»„æ˜éœ€è¦ç»„å»ºä¸€ä¸ªå®¶åº­ã€‚'
  },
  {
    id: 'frieren',
    title: 'è‘¬é€çš„èŠ™è‰è²',
    subtitle: 'Sousou no Frieren',
    author: 'å±±ç”°é’Ÿäºº',
    status: 'ongoing',
    rating: 9.8,
    genres: ['å¥‡å¹»', 'å‰§æƒ…', 'å†’é™©'],
    year: 2020,
    coverImage: 'https://via.placeholder.com/200x280/4ECDC4/FFFFFF?text=èŠ™è‰è²',
    summary: 'ç²¾çµé­”æ³•ä½¿èŠ™è‰è²åœ¨å‹‡è€…æ­»åå¼€å§‹ç†è§£äººç±»çš„æ—…ç¨‹ã€‚'
  }
];

// å…¨å±€å˜é‡
let allMangas = staticMangaData;
let filteredMangas = staticMangaData;

// é˜²æŠ–å‡½æ•°
function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
if (typeof document !== 'undefined') {
  document.addEventListener('DOMContentLoaded', function() {
    try {
      loadMangaData();
      setupEventListeners();
    } catch (error) {
      console.error('åˆå§‹åŒ–å¤±è´¥:', error);
      showErrorState();
    }
  });
}

// åŠ è½½æ¼«ç”»æ•°æ®
function loadMangaData() {
  try {
    showLoadingState();
    
    // ä½¿ç”¨é™æ€æ•°æ®
    if (allMangas.length === 0) {
      showEmptyState();
      return;
    }
    
    filteredMangas = [...allMangas];
    
    // æ˜¾ç¤ºå†…å®¹å¹¶éšè—åŠ è½½çŠ¶æ€
    hideLoadingState();
    showContent();
    
    // æ¸²æŸ“æ¼«ç”»åˆ—è¡¨
    renderMangaGrid();
    
    // å¡«å……ç­›é€‰å™¨é€‰é¡¹
    populateGenreFilter();
    
  } catch (error) {
    console.error('åŠ è½½æ¼«ç”»æ•°æ®å¤±è´¥:', error);
    showErrorState();
  }
}

// æ˜¾ç¤ºåŠ è½½çŠ¶æ€
function showLoadingState() {
  document.getElementById('loading-state').style.display = 'block';
  document.getElementById('error-state').style.display = 'none';
  document.getElementById('empty-state').style.display = 'none';
  document.getElementById('filters').style.display = 'none';
  document.getElementById('manga-grid').style.display = 'none';
}

// æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
function showErrorState() {
  document.getElementById('loading-state').style.display = 'none';
  document.getElementById('error-state').style.display = 'block';
  document.getElementById('empty-state').style.display = 'none';
  document.getElementById('filters').style.display = 'none';
  document.getElementById('manga-grid').style.display = 'none';
}

// æ˜¾ç¤ºç©ºçŠ¶æ€
function showEmptyState() {
  document.getElementById('loading-state').style.display = 'none';
  document.getElementById('error-state').style.display = 'none';
  document.getElementById('empty-state').style.display = 'block';
  document.getElementById('filters').style.display = 'none';
  document.getElementById('manga-grid').style.display = 'none';
}

// éšè—åŠ è½½çŠ¶æ€å¹¶æ˜¾ç¤ºå†…å®¹
function hideLoadingState() {
  document.getElementById('loading-state').style.display = 'none';
  document.getElementById('error-state').style.display = 'none';
  document.getElementById('empty-state').style.display = 'none';
}

// æ˜¾ç¤ºå†…å®¹
function showContent() {
  document.getElementById('filters').style.display = 'flex';
  document.getElementById('manga-grid').style.display = 'grid';
}

// æ¸²æŸ“æ¼«ç”»ç½‘æ ¼
function renderMangaGrid() {
  const container = document.getElementById('manga-grid');
  
  if (filteredMangas.length === 0) {
    container.innerHTML = '<div class="empty-state"><p>æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¼«ç”»</p></div>';
    return;
  }
  
  container.innerHTML = filteredMangas.map(manga => createMangaCard(manga)).join('');
}

// åˆ›å»ºæ¼«ç”»å¡ç‰‡HTML
function createMangaCard(manga) {
  const progressPercentage = manga.totalChapters > 0 ? 
    Math.round((manga.currentChapter / manga.totalChapters) * 100) : 0;
  
  const statusClass = getStatusClass(manga.status);
  const statusText = getStatusText(manga.status);
  
  return `
    <div class="manga-card" onclick="goToMangaDetail('${manga.id}')">
      <div class="manga-cover">
        <img src="${manga.coverImage || 'https://via.placeholder.com/280x400/FF6B6B/FFFFFF?text=' + encodeURIComponent(manga.title)}" 
             alt="${manga.title}" 
             onerror="this.src='https://via.placeholder.com/280x400/FF6B6B/FFFFFF?text=' + encodeURIComponent('${manga.title}')">
        <div class="manga-overlay">
          <div class="manga-rating">${manga.rating || 'N/A'}</div>
          <div class="manga-status ${statusClass}">${statusText}</div>
        </div>
      </div>
      <div class="manga-info">
        <h3 class="manga-title">${manga.title}</h3>
        ${manga.subtitle ? `<div class="manga-subtitle">${manga.subtitle}</div>` : ''}
        <div class="manga-meta">
          <span>${manga.author || 'æœªçŸ¥ä½œè€…'}</span>
          <span>${manga.year || 'æœªçŸ¥å¹´ä»½'}</span>
        </div>
        <div class="manga-genres">${(manga.genres || []).join(' Â· ')}</div>
        <div class="manga-progress">
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${progressPercentage}%"></div>
          </div>
          <span class="progress-text">${manga.currentChapter || 0}/${manga.totalChapters || '?'}</span>
        </div>
      </div>
    </div>
  `;
}

// è·å–çŠ¶æ€æ ·å¼ç±»
function getStatusClass(status) {
  const statusMap = {
    'reading': 'reading',
    'completed': 'completed',
    'planned': 'planned',
    'paused': 'paused',
    'dropped': 'dropped'
  };
  return statusMap[status] || 'unknown';
}

// è·å–çŠ¶æ€æ–‡æœ¬
function getStatusText(status) {
  const statusMap = {
    'reading': 'æ­£åœ¨é˜…è¯»',
    'completed': 'å·²å®Œæˆ',
    'planned': 'è®¡åˆ’é˜…è¯»',
    'paused': 'æš‚åœ',
    'dropped': 'å·²å¼ƒå‘'
  };
  return statusMap[status] || 'æœªçŸ¥çŠ¶æ€';
}

// å¡«å……ç±»å‹ç­›é€‰å™¨
function populateGenreFilter() {
  const genreSelect = document.getElementById('genre-filter');
  const allGenres = new Set();
  
  allMangas.forEach(manga => {
    if (manga.genres) {
      manga.genres.forEach(genre => allGenres.add(genre));
    }
  });
  
  // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™"å…¨éƒ¨ç±»å‹"ï¼‰
  genreSelect.innerHTML = '<option value="">å…¨éƒ¨ç±»å‹</option>';
  
  // æ·»åŠ ç±»å‹é€‰é¡¹
  Array.from(allGenres).sort().forEach(genre => {
    const option = document.createElement('option');
    option.value = genre;
    option.textContent = genre;
    genreSelect.appendChild(option);
  });
}

// è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
function setupEventListeners() {
  // ç­›é€‰å™¨äº‹ä»¶
  document.getElementById('genre-filter').addEventListener('change', applyFilters);
  document.getElementById('status-filter').addEventListener('change', applyFilters);
  document.getElementById('rating-filter').addEventListener('change', applyFilters);
  
  // æœç´¢äº‹ä»¶ï¼ˆä½¿ç”¨é˜²æŠ–ï¼‰
  const searchInput = document.getElementById('search-input');
  searchInput.addEventListener('input', debounce(applyFilters, 300));
  
  // AIåŠ©æ‰‹æŒ‰é’®äº‹ä»¶
  const aiAssistantFab = document.getElementById('aiAssistantFab');
  if (aiAssistantFab) {
    aiAssistantFab.addEventListener('click', openAIAssistant);
  }
}

// åº”ç”¨ç­›é€‰å™¨
function applyFilters() {
  const genreFilter = document.getElementById('genre-filter').value;
  const statusFilter = document.getElementById('status-filter').value;
  const ratingFilter = document.getElementById('rating-filter').value;
  const searchQuery = document.getElementById('search-input').value.toLowerCase().trim();
  
  filteredMangas = allMangas.filter(manga => {
    // ç±»å‹ç­›é€‰
    if (genreFilter && (!manga.genres || !manga.genres.includes(genreFilter))) {
      return false;
    }
    
    // çŠ¶æ€ç­›é€‰
    if (statusFilter && manga.status !== statusFilter) {
      return false;
    }
    
    // è¯„åˆ†ç­›é€‰
    if (ratingFilter) {
      const minRating = parseFloat(ratingFilter);
      const mangaRating = parseFloat(manga.rating) || 0;
      if (mangaRating < minRating) {
        return false;
      }
    }
    
    // æœç´¢ç­›é€‰
    if (searchQuery) {
      const titleMatch = manga.title.toLowerCase().includes(searchQuery);
      const subtitleMatch = manga.subtitle && manga.subtitle.toLowerCase().includes(searchQuery);
      const authorMatch = manga.author && manga.author.toLowerCase().includes(searchQuery);
      
      if (!titleMatch && !subtitleMatch && !authorMatch) {
        return false;
      }
    }
    
    return true;
  });
  
  renderMangaGrid();
}

// è·³è½¬åˆ°æ¼«ç”»è¯¦æƒ…é¡µ
function goToMangaDetail(mangaId) {
  // è¿™é‡Œå¯ä»¥è·³è½¬åˆ°å…·ä½“çš„æ¼«ç”»è¯¦æƒ…é¡µ
  if (typeof window !== 'undefined') {
    window.location.href = `/Anime/manga/${mangaId}.html`;
  }
}

// å…¨å±€å‡½æ•°ï¼Œä¾›é‡æ–°åŠ è½½æŒ‰é’®è°ƒç”¨
if (typeof window !== 'undefined') {
  window.loadMangaData = loadMangaData;
}

// AIåŠ©æ‰‹ç›¸å…³åŠŸèƒ½
let aiDialog = null;

async function openAIAssistant() {
  try {
    if (!aiDialog) {
      // åŠ¨æ€å¯¼å…¥AIå¯¹è¯æ¡†ç»„ä»¶
      const { AIDialog } = await import('/.vuepress/components/AIDialog.js');
      aiDialog = new AIDialog();
      
      // è®¾ç½®æ¼«ç”»é¡µé¢ä¸Šä¸‹æ–‡
      aiDialog.setContext('manga', {
        currentPage: 'manga',
        totalMangas: staticMangaData.length,
        availableGenres: ['åŠ¨ä½œ', 'å†’é™©', 'å–œå‰§', 'å‰§æƒ…', 'å¥‡å¹»', 'ææ€–', 'æµªæ¼«', 'ç§‘å¹»', 'è¿åŠ¨', 'è¶…è‡ªç„¶', 'æƒŠæ‚š'],
        availableStatuses: ['reading', 'completed', 'on-hold', 'dropped', 'plan-to-read']
      });
    }
    
    // è·å–å½“å‰æ¼«ç”»æ•°æ®å¹¶æ‰“å¼€å¯¹è¯æ¡†
    const currentMangas = getCurrentMangaData();
    aiDialog.open(currentMangas, staticMangaData.length);
  } catch (error) {
    console.error('æ‰“å¼€AIåŠ©æ‰‹å¤±è´¥:', error);
    alert('AIåŠ©æ‰‹æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•ã€‚');
  }
}

function getCurrentMangaData() {
  // è·å–å½“å‰æ˜¾ç¤ºçš„æ¼«ç”»æ•°æ®
  const mangaCards = document.querySelectorAll('.manga-card:not([style*="display: none"])');
  return Array.from(mangaCards).map(card => ({
    title: card.querySelector('.manga-title')?.textContent || '',
    genre: card.dataset.genre || '',
    status: card.dataset.status || '',
    rating: card.dataset.rating || ''
  }));
}

// å»¶è¿Ÿåˆå§‹åŒ–AIåŠ©æ‰‹ï¼Œç¡®ä¿DOMå®Œå…¨åŠ è½½
if (typeof window !== 'undefined') {
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      // é¢„åŠ è½½AIåŠ©æ‰‹ç»„ä»¶ï¼ˆå¯é€‰ï¼‰
      // è¿™æ ·å¯ä»¥å‡å°‘é¦–æ¬¡ç‚¹å‡»æ—¶çš„åŠ è½½æ—¶é—´
    }, 2000);
  });
}
</script>

<style>
.manga-zone {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
}

/* åŠ è½½çŠ¶æ€æ ·å¼ */
.loading-state {
  text-align: center;
  padding: 60px 20px;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid #f3f3f3;
  border-top: 4px solid #FF6B6B;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-state p {
  color: #666;
  font-size: 1.1em;
}

/* é”™è¯¯çŠ¶æ€æ ·å¼ */
.error-state {
  text-align: center;
  padding: 60px 20px;
  color: #e74c3c;
}

.retry-button {
  background: #FF6B6B;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1em;
  margin-top: 15px;
  transition: background 0.3s ease;
}

.retry-button:hover {
  background: #ff5252;
}

/* ç©ºçŠ¶æ€æ ·å¼ */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: #666;
  font-size: 1.2em;
}

/* ç­›é€‰å™¨æ ·å¼ */
.filters {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 30px;
  padding: 20px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.filter-group label {
  font-weight: bold;
  color: #333;
  font-size: 0.9em;
}

.filter-group select,
.filter-group input {
  padding: 8px 12px;
  border: 2px solid #e0e0e0;
  border-radius: 5px;
  font-size: 0.9em;
  min-width: 150px;
  transition: border-color 0.3s ease;
}

.filter-group select:focus,
.filter-group input:focus {
  outline: none;
  border-color: #FF6B6B;
}

/* æ¼«ç”»ç½‘æ ¼æ ·å¼ */
.manga-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 25px;
  margin-top: 20px;
}

/* æ¼«ç”»å¡ç‰‡æ ·å¼ */
.manga-card {
  background: white;
  border-radius: 15px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
}

.manga-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.manga-cover {
  position: relative;
  width: 100%;
  height: 350px;
  overflow: hidden;
}

.manga-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.manga-card:hover .manga-cover img {
  transform: scale(1.05);
}

.manga-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.7) 100%);
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  padding: 15px;
}

.manga-rating {
  background: rgba(255, 107, 107, 0.9);
  color: white;
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 0.9em;
  font-weight: bold;
  align-self: flex-start;
}

.manga-status {
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 0.8em;
  font-weight: bold;
  align-self: flex-end;
}

.manga-status.reading {
  background: #4CAF50;
  color: white;
}

.manga-status.completed {
  background: #2196F3;
  color: white;
}

.manga-status.planned {
  background: #FF9800;
  color: white;
}

.manga-status.paused {
  background: #9E9E9E;
  color: white;
}

.manga-status.dropped {
  background: #F44336;
  color: white;
}

.manga-status.unknown {
  background: #607D8B;
  color: white;
}

.manga-info {
  padding: 20px;
}

.manga-title {
  font-size: 1.2em;
  font-weight: bold;
  margin: 0 0 5px 0;
  color: #333;
  line-height: 1.3;
}

.manga-subtitle {
  font-size: 0.9em;
  color: #666;
  margin: 0 0 10px 0;
  line-height: 1.2;
}

.manga-meta {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  font-size: 0.85em;
  color: #888;
}

.manga-genres {
  font-size: 0.85em;
  color: #FF6B6B;
  margin-bottom: 15px;
  font-weight: 500;
}

.manga-progress {
  display: flex;
  align-items: center;
  gap: 10px;
}

.progress-bar {
  flex: 1;
  height: 6px;
  background: #f0f0f0;
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #FF6B6B, #4ECDC4);
  border-radius: 3px;
  transition: width 0.3s ease;
}

.progress-text {
  font-size: 0.8em;
  color: #666;
  font-weight: bold;
  min-width: 50px;
}

.manga-author, .manga-progress {
  color: #888;
  font-size: 0.85em;
  margin: 0 0 3px 0;
}

.manga-description {
  color: #555;
  font-size: 0.9em;
  line-height: 1.4;
  margin: 10px 0 15px 0;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.manga-link {
  color: #007bff;
  text-decoration: none;
  font-weight: bold;
  font-size: 0.9em;
  transition: color 0.3s ease;
}

.manga-link:hover {
  color: #0056b3;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .manga-zone {
    padding: 15px;
  }
  
  .filters {
    flex-direction: column;
    gap: 15px;
  }
  
  .filter-group select,
  .filter-group input {
    min-width: 100%;
  }
  
  .manga-grid {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
  }
  
  .manga-cover {
    height: 300px;
  }
}

@media (max-width: 480px) {
  .manga-grid {
    grid-template-columns: 1fr;
  }
  
  .manga-cover {
    height: 280px;
  }
}

/* AIåŠ©æ‰‹æµ®åŠ¨æŒ‰é’®æ ·å¼ */
.ai-assistant-fab {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
  transition: all 0.3s ease;
  z-index: 1000;
  overflow: hidden;
}

.ai-assistant-fab:hover {
  width: 140px;
  border-radius: 30px;
  transform: translateY(-2px);
  box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
}

.ai-fab-icon {
  font-size: 24px;
  transition: all 0.3s ease;
}

.ai-fab-text {
  color: white;
  font-size: 14px;
  font-weight: 600;
  margin-left: 8px;
  opacity: 0;
  transform: translateX(-10px);
  transition: all 0.3s ease;
  white-space: nowrap;
}

.ai-assistant-fab:hover .ai-fab-text {
  opacity: 1;
  transform: translateX(0);
}

.ai-assistant-fab:hover .ai-fab-icon {
  transform: scale(0.9);
}

/* å“åº”å¼è®¾è®¡ - AIåŠ©æ‰‹æŒ‰é’® */
@media (max-width: 768px) {
  .ai-assistant-fab {
    bottom: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
  }
  
  .ai-assistant-fab:hover {
    width: 120px;
  }
  
  .ai-fab-icon {
    font-size: 20px;
  }
  
  .ai-fab-text {
    font-size: 12px;
  }
}
</style>